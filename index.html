<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Killer Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .view-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .view-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            text-decoration: none;
        }
        
        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        
        .view-btn.active {
            background: linear-gradient(45deg, #27ae60, #229954);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            z-index: 1;
        }
        
        .player-card > * {
            position: relative;
            z-index: 2;
        }
        
        .player-number {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .player-status {
            font-size: 1.1em;
            padding: 12px 24px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
            cursor: pointer;
            min-width: 120px;
        }
        
        .status-alive {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .status-dead {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .timer-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .timer-display {
            font-size: 4em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            font-family: 'Courier New', monospace;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .timer-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .timer-btn:nth-child(1) {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .timer-btn:nth-child(2) {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .timer-btn:nth-child(3) {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .timer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .timer-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Player view colors */
        .player-alive::before { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .player-alive { border-color: #2ecc71; }
        
        .player-dead::before { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .player-dead { border-color: #c0392b; }
        
        /* Character colors */
        .killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .killer { border-color: #ff0000; }
        
        .super-killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .super-killer { border-color: #ff0000; }
        
        .zombie-killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .zombie-killer { border-color: #ff0000; }
        
        .surgeon-killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .surgeon-killer { border-color: #ff0000; }
        
        .shadow-killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .shadow-killer { border-color: #ff0000; }
        
        .imitation-killer::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .imitation-killer { border-color: #ff0000; }
        
        .vampire::before { background: linear-gradient(135deg, #ff0000, #dc143c); }
        .vampire { border-color: #ff0000; }
        
        .detective::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .detective { border-color: #ffd700; }
        
        .doctor::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .doctor { border-color: #ffd700; }
        
        .hunter::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .hunter { border-color: #ffd700; }
        
        .knight::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .knight { border-color: #ffd700; }
        
        .guard::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .guard { border-color: #ffd700; }
        
        .undercover::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .undercover { border-color: #ffd700; }
        
        .undertaker::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .undertaker { border-color: #ffd700; }
        
        .night-watcher::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .night-watcher { border-color: #ffd700; }
        
        .bomber::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .bomber { border-color: #ffd700; }
        
        .priest::before { background: linear-gradient(135deg, #ffd700, #ffcc00); }
        .priest { border-color: #ffd700; }
        
        .civilian::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .civilian { border-color: #2196f3; }
        
        .playboy::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .playboy { border-color: #2196f3; }
        
        .cupid::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .cupid { border-color: #2196f3; }
        
        .idiot::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .idiot { border-color: #2196f3; }
        
        .chicken::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .chicken { border-color: #2196f3; }
        
        .gym-rat::before { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .gym-rat { border-color: #2196f3; }
        
        .none::before { background: linear-gradient(135deg, #374151, #6b7280); }
        .none { border-color: #6b7280; }
        
        .role-dropdown {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            font-size: 1em;
            margin-bottom: 10px;
            width: 100%;
            cursor: pointer;
        }
        
        .role-dropdown option {
            background: #2c3e50;
            color: white;
        }
        
        .skills-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .script-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .character-selection-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .character-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .character-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .character-item.selected {
            border-color: #2196f3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.4), rgba(25, 118, 210, 0.3));
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
            transform: translateY(-2px);
        }
        
        .character-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #fff;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .character-item.selected .character-checkbox {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            color: white;
            border-color: #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.5);
            transform: scale(1.1);
        }
        
        .character-item.selected .character-name {
            color: #2196f3;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .character-item.selected .character-skill {
            color: rgba(33, 150, 243, 0.8);
        }
        
        .character-item.selected .character-emoji {
            filter: brightness(1.2);
            transform: scale(1.1);
        }
        
        .character-info {
            flex-grow: 1;
            min-width: 0;
        }
        
        .character-name {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .character-skill {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .character-emoji {
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        /* Force green colors for character selection - override any conflicts */
        .character-selection-section .character-item.selected {
            border-color: #27ae60 !important;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.4), rgba(46, 204, 113, 0.3)) !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4) !important;
        }
        
        .character-selection-section .character-item.selected .character-checkbox {
            background: linear-gradient(45deg, #27ae60, #2ecc71) !important;
            border-color: #27ae60 !important;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.5) !important;
        }
        
        .character-selection-section .character-item.selected .character-name {
            color: #27ae60 !important;
        }
        
        .character-selection-section .character-item.selected .character-skill {
            color: rgba(39, 174, 96, 0.8) !important;
        }
        
        .character-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .character-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .character-btn.select-all {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .character-btn.deselect-all {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .character-btn.essential-only {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .character-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .script-content {
            display: grid;
            gap: 20px;
        }
        
        .script-phase {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #FFD700;
        }
        
        .script-phase h4 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .script-phase#nightPhase {
            border-left: 4px solid #2196f3;
        }
        
        .script-phase#nightPhase h4 {
            color: #2196f3;
        }
        
        .script-phase ol, .script-phase ul {
            margin-left: 20px;
            line-height: 1.6;
        }
        
        .script-phase li {
            margin-bottom: 8px;
        }
        
        .script-phase strong {
            color: #fff;
            background: rgba(255, 215, 0, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .script-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            margin: 2px;
        }
        
        .script-btn.green {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .script-btn.red {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .script-btn.yellow {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .script-btn.blue {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .script-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .skills-grid .skill-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .skills-grid .skill-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .skills-grid .skill-item.used {
            border-color: #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.4), rgba(46, 204, 113, 0.3));
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
            transform: translateY(-2px);
        }
        
        .skills-grid .skill-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #fff;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .skills-grid .skill-item.used .skill-checkbox {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border-color: #27ae60;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.5);
            transform: scale(1.1);
        }
        
        .skills-grid .skill-info {
            flex-grow: 1;
            min-width: 0;
        }
        
        .skills-grid .skill-character {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .skills-grid .skill-item.used .skill-character {
            color: #27ae60;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .skills-grid .skill-name {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .skills-grid .skill-item.used .skill-name {
            color: rgba(39, 174, 96, 0.8);
        }
        
        .skills-grid .skill-emoji {
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .skills-grid .skill-item.used .skill-emoji {
            filter: brightness(1.2);
            transform: scale(1.1);
        }
        
        .win-conditions-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }
        
        .win-conditions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .win-condition-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .win-title {
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 5px;
        }
        
        .win-title.good-guys {
            color: #ffd700;
        }
        
        .win-title.killers {
            color: #e74c3c;
        }
        
        .win-description {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }
        
        .win-status {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .win-status.ongoing {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid #9ca3af;
        }
        
        .win-status.good-win {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid #ffd700;
        }
        
        .win-status.killer-win {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .reset-section {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 20px;
            padding: 10px;
        }
        
        .reset-btn {
            padding: 8px 16px;
            background: #6b7280;
            border: 1px solid #9ca3af;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(107, 114, 128, 0.3);
        }
        
        .reset-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.5);
            background: #4b5563;
        }
        
        .dead-players {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
        }
        
        .dead-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .dead-player {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .add-player-card {
            background: rgba(255, 255, 255, 0.05);
            border: 3px dashed rgba(255, 255, 255, 0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            position: relative;
        }
        
        .add-player-card:hover {
            border-color: rgba(39, 174, 96, 0.8);
            background: rgba(39, 174, 96, 0.1);
        }
        
        .add-icon {
            font-size: 4em;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }
        
        .add-player-card:hover .add-icon {
            color: #27ae60;
            transform: scale(1.1);
        }
        
        .remove-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }
        
        .remove-icon:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .hidden {
            display: none;
        }
        
        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .firebase-connected {
            background: #27ae60;
            color: white;
        }
        
        .firebase-disconnected {
            background: #e74c3c;
            color: white;
        }
        
        @media (max-width: 768px) {
            .player-number {
                font-size: 3em;
            }
            
            .players-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .player-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Firebase Status Indicator -->
    <div id="firebaseStatus" class="firebase-status firebase-disconnected">
        🔥 Connecting...
    </div>

    <div class="header">
        <h1>🔪 The Killer Game 🔪</h1>
        <div class="view-selector">
            <button class="view-btn" id="playerViewBtn" onclick="showPlayerView()">Player View</button>
            <button class="view-btn" id="gmViewBtn" onclick="showGMView()">GM View</button>
        </div>
    </div>

    <div class="container">
        <!-- Player View -->
        <div id="playerView">
            <div class="timer-section">
                <div class="timer-display" id="timerDisplay">01:00</div>
            </div>
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 2em;">Player Status</h2>
            <div class="players-grid" id="playerGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="dead-players">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.5em;">💀 Dead Players</h3>
                <div class="dead-list" id="deadList">
                    <!-- Dead players will appear here -->
                </div>
            </div>
        </div>

        <!-- GM View -->
        <div id="gmView" class="hidden">
            <h2 style="text-align: center; margin-bottom: 30px; font-size: 2em;">Game Master Panel</h2>
            
            <div class="character-selection-section">
                <h3 style="margin-bottom: 15px; font-size: 1.3em;">🎭 Character Selection</h3>
                <div class="character-grid" id="characterGrid">
                    <!-- Characters will be populated dynamically -->
                </div>
                <div class="character-controls">
                    <button class="character-btn select-all" onclick="selectAllCharacters()">Select All</button>
                    <button class="character-btn deselect-all" onclick="deselectAllCharacters()">Deselect All</button>
                    <button class="character-btn essential-only" onclick="selectEssentialOnly()">Essential Only</button>
                </div>
            </div>
            
            <div class="script-section">
                <h3 style="margin-bottom: 15px; font-size: 1.3em;">📜 Game Master Script</h3>
                <div class="script-content">
                    <div class="script-phase" id="nightPhase">
                        <h4>🌙 Night Phase</h4>
                        <div id="nightPhaseButtons" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                            <!-- Night phase buttons will be populated dynamically -->
                        </div>
                    </div>
                    
                    <div class="script-phase" id="dayPhase">
                        <h4>☀️ Day Phase</h4>
                        <ol>
                            <li><strong>"It's day time. Everyone open your eyes"</strong></li>
                            <li><strong>"Last night [it was a peaceful night] or [Player X] has died"</strong></li>
                            <li><strong>"Please discuss who you think the killers are"</strong></li>
                            <li><strong>"It is time to vote, countdown in 5,4,3,2,1"</strong></li>
                            <li><strong>"Check win conditions"</strong></li>
                        </ol>
                    </div>
                    <div class="timer-controls" style="display: flex; justify-content: center; gap: 15px; margin-top: 15px;">
                        <button class="timer-btn" id="startBtn" onclick="startTimer()">Start</button>
                        <button class="timer-btn" id="pauseBtn" onclick="pauseTimer()">Pause</button>
                        <button class="timer-btn" id="resetTimerBtn" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
            </div>
            
            <div class="skills-section">
                <h3 style="margin-bottom: 15px; font-size: 1.3em;">🎯 Active Special Skills</h3>
                <div class="skills-grid" id="skillsGrid">
                    <!-- Skills will be populated dynamically -->
                </div>
            </div>
            
            <div class="players-grid" id="adminGrid">
                <!-- Admin controls will be generated by JavaScript -->
            </div>
            
            <div class="win-conditions-section">
                <h3 style="margin-bottom: 15px; font-size: 1.3em;">🏆 Check Win Conditions</h3>
                <div class="win-conditions-grid" id="winConditionsGrid">
                    <div class="win-condition-item">
                        <div class="win-title good-guys">Good Guys Victory</div>
                        <div class="win-description">All red characters (killers) must be eliminated</div>
                        <div class="win-status ongoing">Game in progress</div>
                    </div>
                    
                    <div class="win-condition-item">
                        <div class="win-title killers">Killers Victory</div>
                        <div class="win-description">All yellow characters dead OR all blue characters dead OR 2 reds + 1 yellow + 1 blue remaining</div>
                        <div class="win-status ongoing">Game in progress</div>
                    </div>
                </div>
            </div>
            
            <div class="reset-section">
                <button class="reset-btn" onclick="resetAll()">Reset All</button>
            </div>
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>

    <script>
        // ===========================================
        // FIREBASE CONFIGURATION
        // ===========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDv5cOm9FY_iCl1h4l5pnEYdYRBjwlTMGw",
            authDomain: "the-killer-game-f86f6.firebaseapp.com",
            databaseURL: "https://the-killer-game-f86f6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "the-killer-game-f86f6",
            storageBucket: "the-killer-game-f86f6.firebasestorage.app",
            messagingSenderId: "70683989632",
            appId: "1:70683989632:web:a12991a0c3c8cf35db3865"
        };

        // Initialize Firebase
        let database;
        let isFirebaseConnected = false;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            // Test connection
            database.ref('.info/connected').on('value', function(snapshot) {
                isFirebaseConnected = snapshot.val();
                updateFirebaseStatus();
            });
            
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization failed:', error);
            updateFirebaseStatus();
        }

        function updateFirebaseStatus() {
            const statusElement = document.getElementById('firebaseStatus');
            if (isFirebaseConnected) {
                statusElement.textContent = '🔥 Connected';
                statusElement.className = 'firebase-status firebase-connected';
            } else {
                statusElement.textContent = '🔥 Disconnected';
                statusElement.className = 'firebase-status firebase-disconnected';
            }
        }

        // ===========================================
        // GAME DATA AND LOGIC
        // ===========================================

        // Character data
        const characterData = {
            'None': { skill: '', color: 'none', emoji: '' },
            'Killer': { skill: 'Night Kill', color: 'killer', emoji: '🔪' },
            'Super Killer': { skill: 'Take Down', color: 'super-killer', emoji: '🔪' },
            'Zombie Killer': { skill: 'Infect', color: 'zombie-killer', emoji: '🔪' },
            'Surgeon Killer': { skill: 'Surgery', color: 'surgeon-killer', emoji: '🔪' },
            'Shadow Killer': { skill: 'Look Good', color: 'shadow-killer', emoji: '🔪' },
            'Imitation Killer': { skill: 'Imitate', color: 'imitation-killer', emoji: '🔪' },
            'Vampire': { skill: 'Bite', color: 'vampire', emoji: '🔪' },
            'Detective': { skill: 'Inspect', color: 'detective', emoji: '👍' },
            'Doctor': { skill: 'Heal and Poison', color: 'doctor', emoji: '👍' },
            'Hunter': { skill: 'Take Down', color: 'hunter', emoji: '👍' },
            'Knight': { skill: 'Challenge', color: 'knight', emoji: '👍' },
            'Guard': { skill: 'Protect', color: 'guard', emoji: '👍' },
            'Undercover': { skill: 'Look Bad', color: 'undercover', emoji: '👍' },
            'Undertaker': { skill: 'Resurrect', color: 'undertaker', emoji: '👍' },
            'Night Watcher': { skill: 'Vision', color: 'night-watcher', emoji: '👍' },
            'Bomber': { skill: 'Bomb', color: 'bomber', emoji: '👍' },
            'Priest': { skill: 'No Kill', color: 'priest', emoji: '👍' },
            'Civilian': { skill: 'No skill', color: 'civilian', emoji: '👤' },
            'Playboy': { skill: 'Sleep', color: 'playboy', emoji: '👤' },
            'Cupid': { skill: 'Shoot', color: 'cupid', emoji: '👤' },
            'Idiot': { skill: 'No skill', color: 'idiot', emoji: '👤' },
            'Chicken': { skill: 'No skill', color: 'chicken', emoji: '👤' },
            'Gym Rat': { skill: '2 Lives', color: 'gym-rat', emoji: '👤' }
        };

        const roles = Object.keys(characterData);
        const repeatableRoles = ['Killer', 'Civilian'];
        
        let players = [];
        let skillStates = {};
        let selectedCharacters = new Set(['None', 'Killer', 'Civilian']);
        let currentView = 'player'; // 'player' or 'gm'
        let deathOrder = []; // Track the order players die

        // Timer variables
        let timerInterval = null;
        let timeLeft = 60;
        let isTimerRunning = false;

        // Initialize with 10 players
        for (let i = 1; i <= 10; i++) {
            players.push({
                number: i,
                role: 'None',
                status: 'alive'
            });
        }

        // ===========================================
        // FIREBASE FUNCTIONS
        // ===========================================

        function saveToFirebase() {
            if (!isFirebaseConnected || !database) {
                console.log('Firebase not connected, saving locally only');
                return;
            }

            try {
                const gameData = {
                    players: players,
                    skillStates: skillStates,
                    selectedCharacters: Array.from(selectedCharacters),
                    deathOrder: deathOrder,
                    timerState: {
                        timeLeft: timeLeft,
                        isRunning: isTimerRunning
                    },
                    lastUpdated: Date.now()
                };

                console.log('Saving to Firebase:', gameData);
                database.ref('gameState').set(gameData);
                console.log('Game state saved to Firebase successfully');
            } catch (error) {
                console.error('Error saving to Firebase:', error);
            }
        }

        function loadFromFirebase() {
            if (!isFirebaseConnected || !database) {
                console.log('Firebase not connected, using local data');
                return;
            }

            database.ref('gameState').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    console.log('Loading game state from Firebase', data);
                    
                    // Update players
                    if (data.players) {
                        players = data.players;
                        console.log('Updated players:', players);
                    }
                    
                    // Update skill states
                    if (data.skillStates) {
                        skillStates = data.skillStates;
                    }
                    
                    // Update selected characters
                    if (data.selectedCharacters) {
                        selectedCharacters = new Set(data.selectedCharacters);
                    }
                    
                    // Update death order
                    if (data.deathOrder) {
                        deathOrder = data.deathOrder;
                    }
                    
                    // Update timer (only if not currently running)
                    if (data.timerState && !isTimerRunning) {
                        timeLeft = data.timerState.timeLeft || 60;
                        updateTimerDisplay();
                    }
                    
                    // Always re-render both views to ensure sync
                    renderPlayerView();
                    if (currentView === 'gm') {
                        renderCharacterSelection();
                        renderAdminView();
                    }
                }
            });
        }

        // ===========================================
        // VIEW MANAGEMENT
        // ===========================================

        function showPlayerView() {
            currentView = 'player';
            document.getElementById('playerView').classList.remove('hidden');
            document.getElementById('gmView').classList.add('hidden');
            document.getElementById('playerViewBtn').classList.add('active');
            document.getElementById('gmViewBtn').classList.remove('active');
            renderPlayerView();
        }

        function showGMView() {
            currentView = 'gm';
            document.getElementById('playerView').classList.add('hidden');
            document.getElementById('gmView').classList.remove('hidden');
            document.getElementById('playerViewBtn').classList.remove('active');
            document.getElementById('gmViewBtn').classList.add('active');
            renderCharacterSelection();
            renderAdminView();
        }

        // Voice narration scripts
        const voiceScripts = {
            'Night Fall': { text: "It's night fall, everyone close your eyes.", color: 'green' },
            'Killer O': { text: "Killers, open your eyes. Who would you like to kill tonight?", color: 'red' },
            'Killer X': { text: "Killers, close your eyes", color: 'red' },
            'Zombie': { text: "Zombie, who would you like to infect?", color: 'red' },
            'Surgeon': { text: "Surgeon, who's face would you like to alter?", color: 'red' },
            'Imitation': { text: "Imitation killer, who would you like to imitate?", color: 'red' },
            'Vampire O': { text: "Vampire, open your eyes. who would you like to bite?", color: 'red' },
            'Vampire X': { text: "Vampire, close your eyes", color: 'red' },
            'Detective O': { text: "Detective, open your eyes. Who would you like to inspect?", color: 'yellow' },
            'Detective X': { text: "Detective, close your eyes", color: 'yellow' },
            'Doctor O': { text: "Doctor, open your eyes. This person has died, would you like to save them?", color: 'yellow' },
            'Doctor P': { text: "You have a bottle of poison, would you like to use it?", color: 'yellow' },
            'Doctor X': { text: "Doctor, close your eyes", color: 'yellow' },
            'Hunter O': { text: "Hunter, open your eyes", color: 'yellow' },
            'Hunter X': { text: "Hunter, close your eyes", color: 'yellow' },
            'Knight O': { text: "Knight, open your eyes", color: 'yellow' },
            'Knight X': { text: "Knight, close your eyes", color: 'yellow' },
            'Guard O': { text: "Guard, open your eyes. Who would you like to protect?", color: 'yellow' },
            'Guard X': { text: "Guard, close your eyes", color: 'yellow' },
            'Undertaker O': { text: "Undertaker, open your eyes", color: 'yellow' },
            'Undertaker X': { text: "Undertaker, close your eyes", color: 'yellow' },
            'Night W O': { text: "Night Watcher, open your eyes", color: 'yellow' },
            'Night W': { text: "Night Watcher, last night the player voted out was...", color: 'yellow' },
            'Night W X': { text: "Night Watcher, close your eyes", color: 'yellow' },
            'Bomber O': { text: "Bomber, open your eyes", color: 'yellow' },
            'Bomber X': { text: "Bomber, close your eyes", color: 'yellow' },
            'Priest O': { text: "Priest, open your eyes", color: 'yellow' },
            'Priest X': { text: "Priest, close your eyes", color: 'yellow' },
            'Playboy O': { text: "Playboy, open your eyes. Who would you like to sleep with tonight?", color: 'blue' },
            'Playboy X': { text: "Playboy, close your eyes", color: 'blue' },
            'Cupid O': { text: "Cupid, open your eyes. Who would you like to shoot with your arrows?", color: 'blue' },
            'Cupid X': { text: "Cupid, close your eyes", color: 'blue' },
            'Idiot O': { text: "Idiot, open your eyes", color: 'blue' },
            'Idiot X': { text: "Idiot, close your eyes", color: 'blue' },
            'Chicken O': { text: "Chicken, open your eyes", color: 'blue' },
            'Chicken X': { text: "Chicken, close your eyes", color: 'blue' },
            'Chicken N': { text: "Second Night fall Activated", color: 'blue' },
            'Gym Rat O': { text: "Gym Rat, open your eyes", color: 'blue' },
            'Gym Rat X': { text: "Gym Rat, close your eyes", color: 'blue' }
        };

        function renderNightPhaseButtons() {
            const nightPhaseButtons = document.getElementById('nightPhaseButtons');
            if (!nightPhaseButtons) return;

            // Always include Night Fall button
            let buttonsHTML = '<button class="script-btn green" onclick="playVoiceNarration(\'It\\\'s night fall, everyone close your eyes.\')">Night Fall</button>';

            // Get active characters from selected characters and assigned players
            const activeCharacters = new Set();
            
            // Add characters that are selected in character selection
            selectedCharacters.forEach(char => {
                if (char !== 'None') {
                    activeCharacters.add(char);
                }
            });

            // Add characters that are assigned to players
            players.forEach(player => {
                if (player.role !== 'None') {
                    activeCharacters.add(player.role);
                }
            });

            // Character button mapping - only characters with narration buttons
            const characterButtons = {
                'Killer': ['Killer O', 'Killer X'],
                'Zombie Killer': ['Zombie'],
                'Surgeon Killer': ['Surgeon'],
                'Imitation Killer': ['Imitation'],
                'Vampire': ['Vampire O', 'Vampire X'],
                'Detective': ['Detective O', 'Detective X'],
                'Doctor': ['Doctor O', 'Doctor P', 'Doctor X'],
                'Hunter': ['Hunter O', 'Hunter X'],
                'Knight': ['Knight O', 'Knight X'],
                'Guard': ['Guard O', 'Guard X'],
                'Undertaker': ['Undertaker O', 'Undertaker X'],
                'Night Watcher': ['Night W O', 'Night W', 'Night W X'],
                'Bomber': ['Bomber O', 'Bomber X'],
                'Priest': ['Priest O', 'Priest X'],
                'Playboy': ['Playboy O', 'Playboy X'],
                'Cupid': ['Cupid O', 'Cupid X'],
                'Idiot': ['Idiot O', 'Idiot X'],
                'Chicken': ['Chicken O', 'Chicken X', 'Chicken N'],
                'Gym Rat': ['Gym Rat O', 'Gym Rat X']
            };

            // Add buttons for active characters
            activeCharacters.forEach(character => {
                if (characterButtons[character]) {
                    characterButtons[character].forEach(buttonKey => {
                        if (voiceScripts[buttonKey]) {
                            const script = voiceScripts[buttonKey];
                            const escapedText = script.text.replace(/'/g, "\\'");
                            buttonsHTML += `<button class="script-btn ${script.color}" onclick="playVoiceNarration('${escapedText}')">${buttonKey}</button>`;
                        }
                    });
                }
            });

            nightPhaseButtons.innerHTML = buttonsHTML;
        }

        function playVoiceNarration(text) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 0.9;
                utterance.volume = 1.0;
                speechSynthesis.speak(utterance);
            } else {
                alert('Voice narration not supported in this browser. Text: ' + text);
            }
        }

        function getRoleClass(role) {
            return characterData[role]?.color || 'none';
        }

        function renderCharacterSelection() {
            const characterGrid = document.getElementById('characterGrid');
            if (!characterGrid) return;
            
            characterGrid.innerHTML = '';
            
            roles.forEach(role => {
                if (role === 'None') return;
                
                const item = document.createElement('div');
                item.className = `character-item ${selectedCharacters.has(role) ? 'selected' : ''}`;
                
                const character = characterData[role];
                item.innerHTML = `
                    <div class="character-checkbox">${selectedCharacters.has(role) ? '✓' : ''}</div>
                    <div class="character-info">
                        <div class="character-name">${role}</div>
                        <div class="character-skill">${character.skill}</div>
                    </div>
                    <div class="character-emoji">${character.emoji}</div>
                `;
                
                item.onclick = function() {
                    if (selectedCharacters.has(role)) {
                        selectedCharacters.delete(role);
                        players.forEach(player => {
                            if (player.role === role) {
                                player.role = 'None';
                            }
                        });
                    } else {
                        selectedCharacters.add(role);
                    }
                    renderCharacterSelection();
                    renderAdminView();
                    saveToFirebase();
                };
                
                characterGrid.appendChild(item);
            });
        }

        function selectAllCharacters() {
            roles.forEach(role => {
                if (role !== 'None') {
                    selectedCharacters.add(role);
                }
            });
            renderCharacterSelection();
            renderAdminView();
            saveToFirebase();
        }
        
        function deselectAllCharacters() {
            selectedCharacters.clear();
            selectedCharacters.add('None');
            players.forEach(player => {
                player.role = 'None';
            });
            renderCharacterSelection();
            renderAdminView();
            saveToFirebase();
        }
        
        function selectEssentialOnly() {
            selectedCharacters.clear();
            selectedCharacters.add('None');
            selectedCharacters.add('Killer');
            selectedCharacters.add('Civilian');
            players.forEach(player => {
                if (!selectedCharacters.has(player.role)) {
                    player.role = 'None';
                }
            });
            renderCharacterSelection();
            renderAdminView();
            saveToFirebase();
        }

        function getAvailableRoles(currentPlayerIndex) {
            const usedRoles = players
                .filter((player, index) => index !== currentPlayerIndex && player.role !== 'None')
                .map(player => player.role);
            
            return Array.from(selectedCharacters).filter(role => {
                if (role === 'None') return true;
                if (repeatableRoles.includes(role)) return true;
                return !usedRoles.includes(role);
            });
        }

        function renderSkillsGrid() {
            const skillsGrid = document.getElementById('skillsGrid');
            if (!skillsGrid) return;
            
            const activeSkills = new Map();
            
            players.forEach(player => {
                if (player.role !== 'None' && characterData[player.role]?.skill && 
                    characterData[player.role].skill !== 'No skill' && 
                    characterData[player.role].skill !== '') {
                    const skill = characterData[player.role].skill;
                    if (!activeSkills.has(skill)) {
                        activeSkills.set(skill, []);
                    }
                    activeSkills.get(skill).push(player.role);
                }
            });
            
            if (activeSkills.size === 0) {
                skillsGrid.innerHTML = '<div style="text-align: center; color: #bdc3c7;">No special skills selected</div>';
                return;
            }
            
            skillsGrid.innerHTML = '';
            
            Array.from(activeSkills.entries()).forEach(([skill, characters]) => {
                const characterNames = [...new Set(characters)].join(', ');
                
                if (skill === 'Heal and Poison') {
                    if (skillStates['heal'] === undefined) skillStates['heal'] = false;
                    if (skillStates['poison'] === undefined) skillStates['poison'] = false;
                    
                    skillsGrid.innerHTML += `
                        <div class="skill-item ${skillStates['heal'] ? 'used' : ''}" onclick="toggleSkill('heal', this)">
                            <div class="skill-checkbox">${skillStates['heal'] ? '✓' : ''}</div>
                            <div class="skill-info">
                                <div class="skill-character">${characterNames}</div>
                                <div class="skill-name">Heal</div>
                            </div>
                            <div class="skill-emoji">💉</div>
                        </div>
                        <div class="skill-item ${skillStates['poison'] ? 'used' : ''}" onclick="toggleSkill('poison', this)">
                            <div class="skill-checkbox">${skillStates['poison'] ? '✓' : ''}</div>
                            <div class="skill-info">
                                <div class="skill-character">${characterNames}</div>
                                <div class="skill-name">Poison</div>
                            </div>
                            <div class="skill-emoji">☠️</div>
                        </div>
                    `;
                } else if (skill === '2 Lives') {
                    if (skillStates['life1'] === undefined) skillStates['life1'] = false;
                    if (skillStates['life2'] === undefined) skillStates['life2'] = false;
                    
                    skillsGrid.innerHTML += `
                        <div class="skill-item ${skillStates['life1'] ? 'used' : ''}" onclick="toggleSkill('life1', this)">
                            <div class="skill-checkbox">${skillStates['life1'] ? '✓' : ''}</div>
                            <div class="skill-info">
                                <div class="skill-character">${characterNames}</div>
                                <div class="skill-name">Life 1</div>
                            </div>
                            <div class="skill-emoji">❤️</div>
                        </div>
                        <div class="skill-item ${skillStates['life2'] ? 'used' : ''}" onclick="toggleSkill('life2', this)">
                            <div class="skill-checkbox">${skillStates['life2'] ? '✓' : ''}</div>
                            <div class="skill-info">
                                <div class="skill-character">${characterNames}</div>
                                <div class="skill-name">Life 2</div>
                            </div>
                            <div class="skill-emoji">❤️</div>
                        </div>
                    `;
                } else {
                    skillsGrid.innerHTML += `
                        <div class="skill-item" onclick="console.log('${skill} skill activated')">
                            <div class="skill-info">
                                <div class="skill-character">${characterNames}</div>
                                <div class="skill-name">${skill}</div>
                            </div>
                            <div class="skill-emoji">⚡</div>
                        </div>
                    `;
                }
            });
        }

        function toggleSkill(skillId, element) {
            const checkbox = element.querySelector('.skill-checkbox');
            const isUsed = element.classList.contains('used');
            
            if (isUsed) {
                element.classList.remove('used');
                checkbox.textContent = '';
                skillStates[skillId] = false;
            } else {
                element.classList.add('used');
                checkbox.textContent = '✓';
                skillStates[skillId] = true;
            }
            
            saveToFirebase();
        }

        function checkWinConditions() {
            const alivePlayers = players.filter(p => p.status === 'alive');
            const aliveByColor = {
                red: alivePlayers.filter(p => characterData[p.role]?.color?.includes('killer') || p.role === 'Vampire').length,
                yellow: alivePlayers.filter(p => ['detective', 'doctor', 'hunter', 'knight', 'guard', 'undercover', 'undertaker', 'night-watcher', 'bomber', 'priest'].includes(characterData[p.role]?.color)).length,
                blue: alivePlayers.filter(p => ['playboy', 'cupid', 'idiot', 'chicken', 'gym-rat', 'civilian'].includes(characterData[p.role]?.color)).length
            };
            
            // Good guys win if all red characters are dead
            const goodGuysWin = aliveByColor.red === 0 && (aliveByColor.yellow > 0 || aliveByColor.blue > 0);
            
            // Killers win if:
            // 1. All yellow are dead OR all blue are dead (and there are red players alive)
            // 2. OR if there are exactly 2 reds, 1 yellow, and 1 blue left
            const killersWin = aliveByColor.red > 0 && (
                aliveByColor.yellow === 0 || 
                aliveByColor.blue === 0 ||
                (aliveByColor.red === 2 && aliveByColor.yellow === 1 && aliveByColor.blue === 1)
            );
            
            return { goodGuysWin, killersWin, aliveByColor };
        }

        function renderWinConditions() {
            const winConditionsGrid = document.getElementById('winConditionsGrid');
            if (!winConditionsGrid) return;
            
            const { goodGuysWin, killersWin, aliveByColor } = checkWinConditions();
            
            // Check if the specific 2-1-1 condition is met
            const specialKillerWin = aliveByColor.red === 2 && aliveByColor.yellow === 1 && aliveByColor.blue === 1;
            
            let killerWinReason;
            if (killersWin) {
                if (specialKillerWin) {
                    killerWinReason = 'KILLERS WIN! (2 Reds + 1 Yellow + 1 Blue)';
                } else if (aliveByColor.yellow === 0) {
                    killerWinReason = 'KILLERS WIN! (All Yellow Dead)';
                } else if (aliveByColor.blue === 0) {
                    killerWinReason = 'KILLERS WIN! (All Blue Dead)';
                } else {
                    killerWinReason = 'KILLERS WIN!';
                }
            } else {
                killerWinReason = `Red: ${aliveByColor.red}, Yellow: ${aliveByColor.yellow}, Blue: ${aliveByColor.blue}`;
            }
            
            winConditionsGrid.innerHTML = `
                <div class="win-condition-item">
                    <div class="win-title good-guys">Good Guys Victory</div>
                    <div class="win-description">All red characters (killers) must be eliminated</div>
                    <div class="win-status ${goodGuysWin ? 'good-win' : 'ongoing'}">
                        ${goodGuysWin ? 'GOOD GUYS WIN!' : `Red characters alive: ${aliveByColor.red}`}
                    </div>
                </div>
                
                <div class="win-condition-item">
                    <div class="win-title killers">Killers Victory</div>
                    <div class="win-description">All yellow characters dead OR all blue characters dead OR 2 reds + 1 yellow + 1 blue remaining</div>
                    <div class="win-status ${killersWin ? 'killer-win' : 'ongoing'}">
                        ${killerWinReason}
                    </div>
                </div>
            `;
        }

        function addPlayer() {
            if (players.length < 15) {
                players.push({
                    number: players.length + 1,
                    role: 'None',
                    status: 'alive'
                });
                renderAdminView();
                renderPlayerView();
                saveToFirebase();
            }
        }

        function removePlayer(playerNumber) {
            if (players.length > 10 && playerNumber > 10) {
                players = players.filter(player => player.number !== playerNumber);
                players.forEach((player, index) => {
                    player.number = index + 1;
                });
                renderAdminView();
                renderPlayerView();
                saveToFirebase();
            }
        }

        function renderPlayerView() {
            const grid = document.getElementById('playerGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = `player-card ${player.status === 'alive' ? 'player-alive' : 'player-dead'}`;
                card.innerHTML = `
                    <div class="player-number">${player.number}</div>
                    <div class="player-status ${player.status === 'alive' ? 'status-alive' : 'status-dead'}">
                        ${player.status.toUpperCase()}
                    </div>
                `;
                
                // Only allow status toggle in player view if you're not in GM mode
                if (currentView === 'player') {
                    card.onclick = function() {
                        // Players can't toggle status in player view
                        // This is just for display
                    };
                }
                
                grid.appendChild(card);
            });
            
            renderDeadList();
        }

        function renderAdminView() {
            const grid = document.getElementById('adminGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = `player-card ${getRoleClass(player.role)}`;
                
                const availableRoles = getAvailableRoles(index);
                const roleOptions = availableRoles.map(role => 
                    `<option value="${role}" ${player.role === role ? 'selected' : ''}>${characterData[role]?.emoji ? characterData[role].emoji + ' ' : ''}${role}</option>`
                ).join('');
                
                card.innerHTML = `
                    <div class="player-number">${player.number}</div>
                    <select class="role-dropdown" onchange="changeRoleDropdown(${index}, this.value)">
                        ${roleOptions}
                    </select>
                    <div class="player-status ${player.status === 'alive' ? 'status-alive' : 'status-dead'}" 
                         onclick="toggleStatus(${index})">
                        ${player.status.toUpperCase()}
                    </div>
                `;
                
                if (player.number > 10) {
                    const removeIcon = document.createElement('div');
                    removeIcon.className = 'remove-icon';
                    removeIcon.innerHTML = '×';
                    removeIcon.onclick = function(e) {
                        e.stopPropagation();
                        removePlayer(player.number);
                    };
                    card.appendChild(removeIcon);
                }
                
                grid.appendChild(card);
            });
            
            if (players.length < 15) {
                for (let i = players.length + 1; i <= 15; i++) {
                    const addCard = document.createElement('div');
                    addCard.className = 'add-player-card';
                    addCard.innerHTML = '<div class="add-icon">+</div>';
                    addCard.onclick = function() { addPlayer(); };
                    grid.appendChild(addCard);
                    if (players.length >= 14) break;
                }
            }
            
            renderSkillsGrid();
            renderWinConditions();
            renderNightPhaseButtons();
        }

        function renderDeadList() {
            const deadList = document.getElementById('deadList');
            if (!deadList) return;
            
            // Get dead players in the order they died
            const deadPlayersInOrder = [];
            
            // First, add players in death order
            deathOrder.forEach(playerNumber => {
                const player = players.find(p => p.number === playerNumber && p.status === 'dead');
                if (player) {
                    deadPlayersInOrder.push(player);
                }
            });
            
            // Then add any dead players not in death order (shouldn't happen, but just in case)
            players.forEach(player => {
                if (player.status === 'dead' && !deadPlayersInOrder.find(p => p.number === player.number)) {
                    deadPlayersInOrder.push(player);
                }
            });
            
            if (deadPlayersInOrder.length === 0) {
                deadList.innerHTML = '<div style="text-align: center; color: #bdc3c7;">No casualties yet...</div>';
            } else {
                deadList.innerHTML = deadPlayersInOrder.map(player => 
                    `<div class="dead-player">Player ${player.number}</div>`
                ).join('');
            }
        }

        function toggleStatus(index) {
            console.log('Toggling status for player', index, 'from', players[index].status);
            const player = players[index];
            const wasAlive = player.status === 'alive';
            
            player.status = wasAlive ? 'dead' : 'alive';
            
            // Track death order
            if (wasAlive) {
                // Player just died - add to death order if not already there
                if (!deathOrder.includes(player.number)) {
                    deathOrder.push(player.number);
                }
            } else {
                // Player came back to life - remove from death order
                deathOrder = deathOrder.filter(num => num !== player.number);
            }
            
            console.log('New status:', player.status);
            console.log('Death order:', deathOrder);
            
            // Immediately re-render views
            renderAdminView();
            renderPlayerView();
            
            // Save to Firebase
            saveToFirebase();
        }

        function changeRoleDropdown(index, newRole) {
            players[index].role = newRole;
            renderAdminView();
            saveToFirebase();
        }

        function resetAll() {
            players.forEach(player => {
                player.role = 'None';
                player.status = 'alive';
            });
            
            players = players.slice(0, 10);
            players.forEach((player, index) => {
                player.number = index + 1;
            });
            
            skillStates = {};
            deathOrder = [];
            
            renderAdminView();
            renderPlayerView();
            saveToFirebase();
        }

        // ===========================================
        // TIMER FUNCTIONS
        // ===========================================

        function updateTimerDisplay() {
            const timerDisplay = document.getElementById('timerDisplay');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timerDisplay) timerDisplay.textContent = timeString;
        }

        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                
                if (startBtn) startBtn.disabled = true;
                if (pauseBtn) pauseBtn.disabled = false;
                
                timerInterval = setInterval(function() {
                    timeLeft--;
                    updateTimerDisplay();
                    saveToFirebase(); // Save timer state
                    
                    if (timeLeft <= 0) {
                        pauseTimer();
                        timeLeft = 0;
                        updateTimerDisplay();
                    }
                }, 1000);
            }
        }

        function pauseTimer() {
            if (isTimerRunning) {
                isTimerRunning = false;
                clearInterval(timerInterval);
                
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                
                if (startBtn) startBtn.disabled = false;
                if (pauseBtn) pauseBtn.disabled = true;
                
                saveToFirebase(); // Save timer state
            }
        }

        function resetTimer() {
            pauseTimer();
            timeLeft = 60;
            updateTimerDisplay();
            
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (startBtn) startBtn.disabled = false;
            if (pauseBtn) pauseBtn.disabled = true;
            
            saveToFirebase(); // Save timer state
        }

        // ===========================================
        // INITIALIZATION
        // ===========================================

        // Initialize the page
        window.addEventListener('load', function() {
            // Start with player view
            showPlayerView();
            
            // Initialize timer display
            updateTimerDisplay();
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) pauseBtn.disabled = true;
            
            // Wait a moment for Firebase to fully initialize, then set up listeners
            setTimeout(function() {
                loadFromFirebase();
            }, 1000);
            
            console.log('Game interface loaded successfully');
        });

        // Auto-save every 30 seconds as backup
        setInterval(function() {
            if (isFirebaseConnected) {
                saveToFirebase();
            }
        }, 30000);

    </script>
</body>
</html>
